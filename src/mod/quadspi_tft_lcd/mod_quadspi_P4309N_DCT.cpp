/*
 * Copyright (c) 2015 Yoon-Ki Hong
 *
 * This file is subject to the terms and conditions of the MIT License.
 * See the file "LICENSE" in the main directory of this archive for more details.
 */

#include <config.h>
#include <mod/quadspi_tft_lcd/P4309N_DCT.h>
#include <std_ext/malloc.h>
#include <std_ext/string.h>

error_t P4309N_DCT::initialize(config_t config)
{
	char sendBuf[32];

	setConfig(config);

	reset();
	
	sendCmd(0xFF, 0xA5);

	sendCmd(COLMOD, 0x01);		//00---666//01--565
	sendCmd(MACTL_USR, 0x01);	//01:IPS/00:TN
	sendCmd(QSPI_DCTL, 0x00);
	sendCmd(PANEL_CTRL, 0x01);
	sendCmd(VBP, 0x15);
	sendCmd(VFP, 0x15);
	sendCmd(VDDS_TRIM, 0x03);

	sendCmd(MV_CLP, 0xBB);
	sendCmd(VGH_CLP, 0x13);
	sendCmd(VGL_CLP, 0x10);
	sendCmd(RATIO_CTRL, 0x3E);
	sendCmd(MV_PUMP_CLK, 0x25);
	sendCmd(HV_PUMP_CLK, 0x11);
	sendCmd(USR_VGSP, 0x66);
	sendCmd(USR_GVDD, 0x49);
	sendCmd(USR_GVCL, 0x57);
	sendCmd(OSC, 0x08);
	sendCmd(0x74, 0x13);
	sendCmd(MV_CLK_CLP, 0x00);
	sendCmd(0x67, 0x33);
	
	// gate_ed
	sendCmd(GATE_SETTING, 0x4B);
	sendCmd(0X52, 0x7C);
	sendCmd(0X53, 0x45);
	sendCmd(0X54, 0x77);

	// source
	sendCmd(FSM_HBP_O, 0x0A);
	sendCmd(FSM_HFP_O, 0x2A);
	sendCmd(HSM_HBP_E, 0x0A);
	sendCmd(HSM_HFP_E, 0x1A);
	sendCmd(0x56, 0x43);
	sendCmd(0x57, 0x42);
	sendCmd(0x58, 0x3C);
	sendCmd(0x59, 0x64);
	sendCmd(0x5A, 0x41);
	sendCmd(0x5B, 0x3C);
	sendCmd(0x5C, 0x02);
	sendCmd(0x5D, 0x3C);
	sendCmd(0x5E, 0x1F);
	sendCmd(0x60, 0x80);
	sendCmd(0x61, 0x3F);
	sendCmd(0x62, 0x21);
	sendCmd(0x63, 0x07);
	sendCmd(0x64, 0xE0);
	sendCmd(0x65, 0x01);
	sendCmd(LVD_SET, 0x14);
	sendCmd(0xCA, 0x20);
	sendCmd(0xCB, 0x52);
	sendCmd(0xCC, 0x10);
	sendCmd(0xCD, 0x42);
	sendCmd(0xD0, 0x20);
	sendCmd(0xD1, 0x52);
	sendCmd(0xD2, 0x10);
	sendCmd(0xD3, 0x42);
	sendCmd(0xD4, 0x0A);
	sendCmd(0xD5, 0x32);
	sendCmd(DVDD_TRIM, 0x06);
	sendCmd(ESD_CTRL, 0x00);

	// test mode
	sendCmd(0xF8, 0x06);
	sendCmd(0xF9, 0x00);
	
	// BOE IPS GAMMA 0508
	sendCmd(GAMMA_P_SEL, 0x00);
	sendCmd(0x81, 0x05);
	sendCmd(0x82, 0x02);
	sendCmd(0x83, 0x38);
	sendCmd(0x84, 0x37);
	sendCmd(0x85, 0x28);
	sendCmd(0x86, 0x2D);
	sendCmd(0x87, 0x40);
	sendCmd(0x88, 0x09);
	sendCmd(0x89, 0x0F);
	sendCmd(0x8A, 0x18);
	sendCmd(0x8B, 0x12);
	sendCmd(0x8C, 0x15);
	sendCmd(0x8D, 0x11);
	sendCmd(0x8E, 0x12);
	sendCmd(0x8F, 0x19);
	sendCmd(0x90, 0x0A);
	sendCmd(0x91, 0x11);
	sendCmd(0x92, 0x19);

	sendCmd(0xA0, 0x00);
	sendCmd(0xA1, 0x03);
	sendCmd(0xA2, 0x02);
	sendCmd(0xA3, 0x37);
	sendCmd(0xA4, 0x36);
	sendCmd(0xA5, 0x28);
	sendCmd(0xA6, 0x1A);
	sendCmd(0xA7, 0x3F);
	sendCmd(0xA8, 0x05);
	sendCmd(0xA9, 0x0C);
	sendCmd(0xAA, 0x14);
	sendCmd(0xAB, 0x0E);
	sendCmd(0xAC, 0x15);
	sendCmd(0xAD, 0x15);
	sendCmd(0xAE, 0x11);
	sendCmd(0xAF, 0x0F);
	sendCmd(0xB0, 0x01);
	sendCmd(0xB1, 0x0D);
	sendCmd(0xB2, 0x12);

	sendCmd(0xFF, 0x00);

	sendCmd(0x11);
	thread::delay(120);

	sendCmd(0x29);
	thread::delay(20);

	return error_t::ERROR_NONE;
}

Size P4309N_DCT::getLcdSize(void)
{
	return {480, 272};
}

Size P4309N_DCT::getCanvasSize(void)
{
	return getLcdSize();
}

P4309N_DCT::P4309N_DCT(void)
{
	//setSize({240, 320});
	//setColorMode(COLOR_MODE_RGB565);
}


